<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯• - Just in Time</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="scripts/seasons.js"></script>
    <script src="scripts/flower.js"></script>
    <style>
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-section {
            margin-bottom: 3rem;
            padding: 2rem;
            border-radius: 1rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .test-item {
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        
        .flower-showcase {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .flower-item {
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            min-width: 120px;
        }
        
        #tree-canvas {
            width: 100%;
            height: 300px;
            border-radius: 1rem;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .theme-controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 95, 191, 0.3);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pass {
            background: #22c55e;
        }
        
        .status-fail {
            background: #ef4444;
        }
        
        .status-pending {
            background: #f59e0b;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="test-section glass-effect">
            <h1>ğŸš€ Just in Time åŠŸèƒ½æµ‹è¯•é¢æ¿</h1>
            <p>æµ‹è¯•æ‰€æœ‰æ–°å¢åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
            
            <div class="theme-controls">
                <button class="control-btn" onclick="setTheme('light')">æµ…è‰²ä¸»é¢˜</button>
                <button class="control-btn" onclick="setTheme('dark')">æ·±è‰²ä¸»é¢˜</button>
                <button class="control-btn" onclick="setTheme('auto')">è‡ªåŠ¨ä¸»é¢˜</button>
                <button class="control-btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            </div>
        </header>
        
        <!-- ä¸»é¢˜ç³»ç»Ÿæµ‹è¯• -->
        <section class="test-section glass-effect">
            <h2><span id="theme-status" class="status-indicator status-pending"></span>ä¸»é¢˜ç³»ç»Ÿæµ‹è¯•</h2>
            <p>æµ‹è¯•æ·±æµ…è‰²ä¸»é¢˜åˆ‡æ¢å’ŒCSSå˜é‡ç³»ç»Ÿ</p>
            
            <div class="test-grid">
                <div class="test-item glass-effect-secondary">
                    <h3>ä¸»è¦é¢œè‰²</h3>
                    <div style="background: var(--primary-color); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                    <div style="background: var(--secondary-color); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                    <div style="background: var(--accent-color); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                </div>
                
                <div class="test-item glass-effect-accent">
                    <h3>èƒŒæ™¯æ¸å˜</h3>
                    <div style="background: var(--bg-gradient-morning); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                    <div style="background: var(--bg-gradient-day); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                    <div style="background: var(--bg-gradient-evening); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                    <div style="background: var(--bg-gradient-night); height: 30px; border-radius: 5px; margin: 5px 0;"></div>
                </div>
            </div>
        </section>
        
        <!-- å››å­£æ ‘æµ‹è¯• -->
        <section class="test-section glass-effect">
            <h2><span id="tree-status" class="status-indicator status-pending"></span>å››å­£æ ‘Canvasæ¸²æŸ“æµ‹è¯•</h2>
            <p>æµ‹è¯•æ°´å½©é£æ ¼å››å­£æ ‘å’Œç²’å­æ•ˆæœ</p>
            
            <canvas id="tree-canvas"></canvas>
            
            <div class="theme-controls">
                <button class="control-btn" onclick="changeSeason('spring')">æ˜¥å­£</button>
                <button class="control-btn" onclick="changeSeason('summer')">å¤å­£</button>
                <button class="control-btn" onclick="changeSeason('autumn')">ç§‹å­£</button>
                <button class="control-btn" onclick="changeSeason('winter')">å†¬å­£</button>
                <button class="control-btn" onclick="toggleAnimation()">æš‚åœ/æ¢å¤</button>
            </div>
        </section>
        
        <!-- èŠ±æœµSVGæµ‹è¯• -->
        <section class="test-section glass-effect">
            <h2><span id="flower-status" class="status-indicator status-pending"></span>èŠ±æœµSVGç”Ÿæˆå™¨æµ‹è¯•</h2>
            <p>æµ‹è¯•ä¸åŒæˆé•¿é˜¶æ®µçš„ç²¾ç¾èŠ±æœµSVG</p>
            
            <div class="flower-showcase">
                <div class="flower-item glass-effect-secondary">
                    <h4>ç§å­ (Level 0)</h4>
                    <div id="flower-0"></div>
                </div>
                <div class="flower-item glass-effect-secondary">
                    <h4>å‡ºèŠ½ (Level 1)</h4>
                    <div id="flower-1"></div>
                </div>
                <div class="flower-item glass-effect-secondary">
                    <h4>å°è‹— (Level 2)</h4>
                    <div id="flower-2"></div>
                </div>
                <div class="flower-item glass-effect-secondary">
                    <h4>èŠ±éª¨æœµ (Level 3)</h4>
                    <div id="flower-3"></div>
                </div>
                <div class="flower-item glass-effect-secondary">
                    <h4>å¼€èŠ± (Level 4)</h4>
                    <div id="flower-4"></div>
                </div>
            </div>
            
            <div class="theme-controls">
                <button class="control-btn" onclick="updateFlowerTheme('light')">æµ…è‰²èŠ±æœµ</button>
                <button class="control-btn" onclick="updateFlowerTheme('dark')">æ·±è‰²èŠ±æœµ</button>
                <button class="control-btn" onclick="animateFlowers()">åŠ¨ç”»æ•ˆæœ</button>
            </div>
        </section>
        
        <!-- å“åº”å¼æµ‹è¯• -->
        <section class="test-section glass-effect">
            <h2><span id="responsive-status" class="status-indicator status-pending"></span>å“åº”å¼è®¾è®¡æµ‹è¯•</h2>
            <p>æµ‹è¯•è‡ªé€‚åº”ç¼©æ”¾å’Œæ–­ç‚¹ç³»ç»Ÿ</p>
            
            <div class="test-grid">
                <div class="test-item glass-effect-secondary">
                    <h3>å½“å‰è§†å£</h3>
                    <p id="viewport-info">-</p>
                </div>
                <div class="test-item glass-effect-secondary">
                    <h3>è®¾å¤‡åƒç´ æ¯”</h3>
                    <p id="dpr-info">-</p>
                </div>
                <div class="test-item glass-effect-secondary">
                    <h3>å­—ä½“å¤§å°</h3>
                    <p id="font-size-info">-</p>
                </div>
                <div class="test-item glass-effect-secondary">
                    <h3>å®¹å™¨å¤§å°</h3>
                    <p id="container-info">-</p>
                </div>
            </div>
        </section>
        
        <!-- æ¯›ç»ç’ƒæ•ˆæœæµ‹è¯• -->
        <section class="test-section glass-effect">
            <h2><span id="glass-status" class="status-indicator status-pending"></span>æ¯›ç»ç’ƒæ•ˆæœæµ‹è¯•</h2>
            <p>æµ‹è¯•backdrop-filterå’Œæ¸å˜æ•ˆæœ</p>
            
            <div class="test-grid">
                <div class="test-item glass-effect">æ ‡å‡†æ¯›ç»ç’ƒ</div>
                <div class="test-item glass-effect-secondary">æ¬¡è¦æ¯›ç»ç’ƒ</div>
                <div class="test-item glass-effect-accent">å¼ºè°ƒæ¯›ç»ç’ƒ</div>
            </div>
        </section>
        
        <!-- æµ‹è¯•ç»“æœ -->
        <section class="test-section glass-effect">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
            <div id="test-results">
                <p>ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹æµ‹è¯•...</p>
            </div>
        </section>
    </div>
    
    <script>
        let seasonsTree = null;
        let flowerGenerator = null;
        let animationPaused = false;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initializeTests();
            updateResponsiveInfo();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', updateResponsiveInfo);
        });
        
        function initializeTests() {
            // åˆå§‹åŒ–å››å­£æ ‘
            if (window.SeasonsTreeRenderer) {
                seasonsTree = new SeasonsTreeRenderer('tree-canvas');
                seasonsTree.startAnimation();
                updateStatus('tree-status', 'pass');
            } else {
                updateStatus('tree-status', 'fail');
            }
            
            // åˆå§‹åŒ–èŠ±æœµç”Ÿæˆå™¨
            if (window.FlowerSVGGenerator) {
                flowerGenerator = new FlowerSVGGenerator();
                updateFlowerDisplay();
                updateStatus('flower-status', 'pass');
            } else {
                updateStatus('flower-status', 'fail');
            }
            
            // æµ‹è¯•ä¸»é¢˜ç³»ç»Ÿ
            testThemeSystem();
            
            // æµ‹è¯•å“åº”å¼
            testResponsiveSystem();
            
            // æµ‹è¯•æ¯›ç»ç’ƒæ•ˆæœ
            testGlassEffect();
        }
        
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            updateFlowerDisplay(); // é‡æ–°ç”ŸæˆèŠ±æœµä»¥é€‚åº”ä¸»é¢˜
        }
        
        function changeSeason(season) {
            if (seasonsTree) {
                seasonsTree.changeSeason(season);
            }
        }
        
        function toggleAnimation() {
            if (!seasonsTree) return;
            
            if (animationPaused) {
                seasonsTree.startAnimation();
                animationPaused = false;
            } else {
                seasonsTree.stopAnimation();
                animationPaused = true;
            }
        }
        
        function updateFlowerDisplay() {
            if (!flowerGenerator) return;
            
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            
            for (let i = 0; i < 5; i++) {
                const container = document.getElementById(`flower-${i}`);
                if (container) {
                    container.innerHTML = flowerGenerator.generateFlowerSVG(i, currentTheme);
                }
            }
        }
        
        function updateFlowerTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            updateFlowerDisplay();
        }
        
        function animateFlowers() {
            for (let i = 0; i < 5; i++) {
                const container = document.getElementById(`flower-${i}`);
                if (container && flowerGenerator) {
                    container.innerHTML = flowerGenerator.generateAnimatedFlowerSVG(i, 'glow');
                }
            }
        }
        
        function updateResponsiveInfo() {
            document.getElementById('viewport-info').textContent = 
                `${window.innerWidth} x ${window.innerHeight}px`;
            
            document.getElementById('dpr-info').textContent = 
                window.devicePixelRatio || 1;
            
            document.getElementById('font-size-info').textContent = 
                getComputedStyle(document.documentElement).fontSize;
            
            document.getElementById('container-info').textContent = 
                document.querySelector('.test-container').offsetWidth + 'px';
        }
        
        function testThemeSystem() {
            const testEl = document.createElement('div');
            testEl.style.color = 'var(--primary-color)';
            document.body.appendChild(testEl);
            
            const color = getComputedStyle(testEl).color;
            document.body.removeChild(testEl);
            
            updateStatus('theme-status', color !== 'var(--primary-color)' ? 'pass' : 'fail');
        }
        
        function testResponsiveSystem() {
            const hasContainerQueries = CSS.supports('container-type: inline-size');
            const hasClamp = CSS.supports('font-size: clamp(14px, 2vw, 18px)');
            
            updateStatus('responsive-status', hasContainerQueries && hasClamp ? 'pass' : 'fail');
        }
        
        function testGlassEffect() {
            const hasBackdropFilter = CSS.supports('backdrop-filter: blur(10px)') || 
                                     CSS.supports('-webkit-backdrop-filter: blur(10px)');
            
            updateStatus('glass-status', hasBackdropFilter ? 'pass' : 'fail');
        }
        
        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-indicator status-${status}`;
            }
        }
        
        function runAllTests() {
            const results = [];
            
            // æ”¶é›†æµ‹è¯•ç»“æœ
            const statuses = ['theme-status', 'tree-status', 'flower-status', 'responsive-status', 'glass-status'];
            const names = ['ä¸»é¢˜ç³»ç»Ÿ', 'å››å­£æ ‘æ¸²æŸ“', 'èŠ±æœµSVGç”Ÿæˆ', 'å“åº”å¼è®¾è®¡', 'æ¯›ç»ç’ƒæ•ˆæœ'];
            
            statuses.forEach((statusId, index) => {
                const element = document.getElementById(statusId);
                const status = element.className.includes('status-pass') ? 'âœ… é€šè¿‡' : 
                              element.className.includes('status-fail') ? 'âŒ å¤±è´¥' : 
                              'â³ å¾…æµ‹';
                results.push(`${names[index]}: ${status}`);
            });
            
            // æ˜¾ç¤ºç»“æœ
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = `
                <h3>ğŸ” æµ‹è¯•å®Œæˆ</h3>
                <ul style="text-align: left;">
                    ${results.map(result => `<li>${result}</li>`).join('')}
                </ul>
                <p><strong>æµè§ˆå™¨ä¿¡æ¯:</strong> ${navigator.userAgent}</p>
                <p><strong>æµ‹è¯•æ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
            `;
        }
    </script>
</body>
</html>